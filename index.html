<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Power Nuke Admin CDN</title>
  <style id="dynamic-style"></style>
</head>
<body>
  <h1>🎬 Power Nuke Admin CDN</h1>
  <p>Every file is UUID-logged, timestamped, and styled with randomized color combos.</p>
  <div id="file-list">Loading files...</div>

  <script>
    // 🎨 Color palette (no white)
    const baseColors = [
      "#000000", "#ff0000", "#cc0000", "#990000",
      "#ff9900", "#ff6600", "#cc5500",
      "#ffff00", "#cccc00", "#999900",
      "#0000ff", "#3366ff", "#0033cc",
      "#800080", "#9933cc", "#660066",
      "#8a2be2", "#9400d3", "#7a00cc"
    ];

    // 🧠 Pick 7 unique colors
    const picked = [];
    while (picked.length < 7) {
      const color = baseColors[Math.floor(Math.random() * baseColors.length)];
      if (!picked.includes(color)) picked.push(color);
    }
    const [bg, text, border, link, hover, button, heading] = picked;

    // 🎨 Inject dynamic styles
    const style = `
      body {
        font-family: monospace;
        background-color: ${bg};
        color: ${text};
        padding: 2em;
      }
      h1 {
        color: ${heading};
      }
      .file-entry {
        margin-bottom: 2em;
        padding: 1em;
        border: 2px solid ${border};
        border-radius: 8px;
        background-color: ${bg === "#000000" ? "#111111" : bg};
      }
      a {
        color: ${link};
        text-decoration: none;
      }
      a:hover {
        color: ${hover};
        text-decoration: underline;
      }
      button {
        margin-top: 0.5em;
        margin-right: 0.5em;
        background-color: ${bg === "#000000" ? "#222222" : bg};
        color: ${button};
        border: 1px solid ${button};
        padding: 0.3em 0.6em;
        cursor: pointer;
        font-family: monospace;
      }
      button:hover {
        background-color: ${button};
        color: ${bg};
      }
      video {
        width: 100%;
        max-width: 720px;
        margin-top: 1em;
        border: 2px solid ${border};
        border-radius: 6px;
        display: block;
      }
      .controls {
        margin-top: 0.5em;
      }
      .duration {
        margin-top: 0.5em;
        font-size: 0.9em;
        color: ${text};
      }
    `;
    document.getElementById("dynamic-style").textContent = style;

    // 📜 Load manifest
    fetch("uploads/manifest.json")
      .then(res => res.json())
      .then(data => {
        const container = document.getElementById("file-list");
        container.innerHTML = "";
        const entries = Object.entries(data).sort((a, b) => b[1].timestamp - a[1].timestamp);
        for (const [filename, meta] of entries) {
          const ext = filename.split(".").pop().toLowerCase();
          const isVideo = ["mp4", "webm", "mov", "m4v"].includes(ext);
          const div = document.createElement("div");
          div.className = "file-entry";
          const videoId = `vid-${meta.uuid}`;
          div.innerHTML = `
            <strong>${filename}</strong><br>
            UUID: <code>${meta.uuid}</code><br>
            Timestamp: <code>${meta.timestamp}</code><br>
            <a href="${meta.link}" target="_blank">🔗 Direct Link</a><br>
            <button onclick="copyLink('${meta.link}')">📋 Copy Link</button>
            <a href="${meta.link}" download><button>📥 Download</button></a>
            ${isVideo ? `
              <video id="${videoId}" src="${meta.link}" controls></video>
              <div class="controls">
                <button onclick="document.getElementById('${videoId}').play()">▶️ Play</button>
                <button onclick="document.getElementById('${videoId}').pause()">⏸️ Pause</button>
                <button onclick="document.getElementById('${videoId}').currentTime -= 10">⏪ Rewind 10s</button>
              </div>
              <div class="duration" id="${videoId}-duration">⏱️ Duration: loading...</div>
            ` : `<p>📁 Not a video file</p>`}
          `;
          container.appendChild(div);

          // ⏱️ Load duration
          if (isVideo) {
            const vid = document.getElementById(videoId);
            vid.addEventListener("loadedmetadata", () => {
              const dur = Math.floor(vid.duration);
              const min = Math.floor(dur / 60);
              const sec = dur % 60;
              document.getElementById(`${videoId}-duration`).textContent =
                `⏱️ Duration: ${min}m ${sec}s`;
            });
          }
        }
      })
      .catch(err => {
        document.getElementById("file-list").innerText = "⚠️ Failed to load manifest.";
        console.error(err);
      });

    // 📋 Copy to clipboard
    function copyLink(link) {
      navigator.clipboard.writeText(link)
        .then(() => alert("✅ Link copied to clipboard!"))
        .catch(() => alert("❌ Failed to copy link."));
    }
  </script>
</body>
</html>
