<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Goplop’s CDN Vault</title>
  <style id="dynamic-style"></style>
</head>
<body>
  <h1>📦 Goplop’s CDN Vault</h1>
  <p>All files are UUID-logged and timestamped for audit clarity.</p>
  <div id="file-list">Loading files...</div>

  <script>
    // 🎨 Color pool
    const colorPool = [
      "#000000", // black
      "#ff0000", // red
      "#ff9900", // orange
      "#ffff00", // yellow
      "#0000ff", // blue
      "#8a2be2", // violet
      "#800080"  // purple
    ];

    // 🔀 Shuffle and assign unique colors
    const shuffled = colorPool.sort(() => 0.5 - Math.random());
    const [bg, text, border, link, hover, button, heading] = shuffled;

    // 🧬 Inject dynamic styles
    const style = `
      body {
        font-family: monospace;
        background-color: ${bg};
        color: ${text};
        padding: 2em;
      }
      h1 {
        color: ${heading};
      }
      .file-entry {
        margin-bottom: 1.5em;
        padding: 1em;
        border: 1px solid ${border};
        border-radius: 8px;
        background-color: ${bg === "#000000" ? "#111111" : bg};
      }
      a {
        color: ${link};
        text-decoration: none;
      }
      a:hover {
        color: ${hover};
        text-decoration: underline;
      }
      button {
        margin-top: 0.5em;
        background-color: ${bg === "#000000" ? "#222222" : bg};
        color: ${button};
        border: 1px solid ${button};
        padding: 0.3em 0.6em;
        cursor: pointer;
        font-family: monospace;
      }
      button:hover {
        background-color: ${button};
        color: ${bg};
      }
    `;
    document.getElementById("dynamic-style").textContent = style;

    // 📜 Load manifest
    fetch("uploads/manifest.json")
      .then(res => res.json())
      .then(data => {
        const container = document.getElementById("file-list");
        container.innerHTML = "";
        const entries = Object.entries(data).sort((a, b) => b[1].timestamp - a[1].timestamp);
        for (const [filename, meta] of entries) {
          const div = document.createElement("div");
          div.className = "file-entry";
          div.innerHTML = `
            <strong>${filename}</strong><br>
            UUID: <code>${meta.uuid}</code><br>
            Timestamp: <code>${meta.timestamp}</code><br>
            <a href="${meta.link}" target="_blank">🔗 View File</a><br>
            <button onclick="copyLink('${meta.link}')">📋 Copy Link</button>
          `;
          container.appendChild(div);
        }
      })
      .catch(err => {
        document.getElementById("file-list").innerText = "⚠️ Failed to load manifest.";
        console.error(err);
      });

    // 📋 Copy to clipboard
    function copyLink(link) {
      navigator.clipboard.writeText(link)
        .then(() => alert("✅ Link copied to clipboard!"))
        .catch(() => alert("❌ Failed to copy link."));
    }
  </script>
</body>
</html>
