<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Goplop’s CDN Vault</title>
  <style id="dynamic-style"></style>
</head>
<body>
  <h1>📦 Goplop’s CDN Vault</h1>
  <p>All files are UUID-logged and timestamped for audit clarity.</p>
  <div id="file-list">Loading files...</div>

  <script>
    // 🎲 Red variants
    const redVariants = [
      "#ff0000", "#ff4d4d", "#ff1a75", "#ff3333", "#ff6666",
      "#ff0055", "#ff2200", "#ff0033", "#ff2e2e", "#ff4444"
    ];

    // 🧠 Load history from localStorage
    let used = JSON.parse(localStorage.getItem("usedRedVariants") || "[]");

    // 🧼 Reset if all used
    if (used.length >= redVariants.length) used = [];

    // 🧪 Pick unused color
    const unused = redVariants.filter(c => !used.includes(c));
    const accent = unused[Math.floor(Math.random() * unused.length)];
    used.push(accent);
    localStorage.setItem("usedRedVariants", JSON.stringify(used));

    // 🎨 Inject dynamic styles
    const style = `
      body {
        font-family: monospace;
        background-color: #000;
        color: #00bfff;
        padding: 2em;
      }
      h1 {
        color: ${accent};
      }
      .file-entry {
        margin-bottom: 1.5em;
        padding: 1em;
        border: 1px solid ${accent};
        border-radius: 8px;
        background-color: #111;
      }
      a {
        color: ${accent};
        text-decoration: none;
      }
      a:hover {
        text-decoration: underline;
      }
      button {
        margin-top: 0.5em;
        background-color: #222;
        color: ${accent};
        border: 1px solid ${accent};
        padding: 0.3em 0.6em;
        cursor: pointer;
        font-family: monospace;
      }
      button:hover {
        background-color: ${accent};
        color: #000;
      }
    `;
    document.getElementById("dynamic-style").textContent = style;

    // 📜 Load manifest
    fetch("uploads/manifest.json")
      .then(res => res.json())
      .then(data => {
        const container = document.getElementById("file-list");
        container.innerHTML = "";
        const entries = Object.entries(data).sort((a, b) => b[1].timestamp - a[1].timestamp);
        for (const [filename, meta] of entries) {
          const div = document.createElement("div");
          div.className = "file-entry";
          div.innerHTML = `
            <strong>${filename}</strong><br>
            UUID: <code>${meta.uuid}</code><br>
            Timestamp: <code>${meta.timestamp}</code><br>
            <a href="${meta.link}" target="_blank">🔗 View File</a><br>
            <button onclick="copyLink('${meta.link}')">📋 Copy Link</button>
          `;
          container.appendChild(div);
        }
      })
      .catch(err => {
        document.getElementById("file-list").innerText = "⚠️ Failed to load manifest.";
        console.error(err);
      });

    // 📋 Copy to clipboard
    function copyLink(link) {
      navigator.clipboard.writeText(link)
        .then(() => alert("✅ Link copied to clipboard!"))
        .catch(() => alert("❌ Failed to copy link."));
    }
  </script>
</body>
</html>
