<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Power Nuke Admin CDN</title>
  <style id="dynamic-style"></style>
</head>
<body>
  <h1>üé¨ Power Nuke Admin CDN</h1>
  <div id="app">Loading...</div>

  <script>
    // === Color theming ===
    const baseColors = [
      "#000000", "#ff0000", "#cc0000", "#990000",
      "#ff9900", "#ff6600", "#cc5500",
      "#ffff00", "#cccc00", "#999900",
      "#0000ff", "#3366ff", "#0033cc",
      "#800080", "#9933cc", "#660066",
      "#8a2be2", "#9400d3", "#7a00cc"
    ];
    const picked = [];
    while (picked.length < 7) {
      const color = baseColors[Math.floor(Math.random() * baseColors.length)];
      if (!picked.includes(color)) picked.push(color);
    }
    const [bg, text, border, link, hover, button, heading] = picked;

    document.getElementById("dynamic-style").textContent = `
      body { font-family: monospace; background:${bg}; color:${text}; padding:2em; }
      h1 { color:${heading}; }
      .file-entry { margin-bottom:1.5em; padding:1em; border:2px solid ${border};
        border-radius:8px; background:${bg === "#000000" ? "#111" : bg}; }
      a { color:${link}; text-decoration:none; }
      a:hover { color:${hover}; text-decoration:underline; }
      button { margin:0.5em 0.5em 0 0; background:${bg === "#000000" ? "#222" : bg};
        color:${button}; border:1px solid ${button}; padding:0.3em 0.6em; cursor:pointer; }
      button:hover { background:${button}; color:${bg}; }
      video { width:100%; max-width:720px; margin-top:1em; border:2px solid ${border};
        border-radius:6px; display:block; }
      .controls { margin-top:0.5em; }
      .duration { margin-top:0.5em; font-size:0.9em; color:${text}; }
    `;

    // === Routing logic ===
    const params = new URLSearchParams(window.location.search);
    const uuid = params.get("id");
    const app = document.getElementById("app");

    fetch("uploads/manifest.json")
      .then(res => res.json())
      .then(data => {
        if (!uuid) {
          // === List view ===
          app.innerHTML = "<h2>Available Videos</h2>";
          const ul = document.createElement("ul");
          for (const [filename, meta] of Object.entries(data)) {
            const li = document.createElement("li");
            li.innerHTML = `<a href="?id=${meta.uuid}">${filename}</a>`;
            ul.appendChild(li);
          }
          app.appendChild(ul);
        } else {
          // === Single video view ===
          const entry = Object.values(data).find(v => v.uuid === uuid);
          if (!entry) {
            app.textContent = "‚ùå Video not found.";
            return;
          }
          const filename = Object.keys(data).find(k => data[k].uuid === uuid);
          const link = entry.link;

          app.innerHTML = `
            <h2>${filename}</h2>
            <p>UUID: <code>${entry.uuid}</code></p>
            <p>Timestamp: <code>${entry.timestamp}</code></p>
            <video id="player" src="${link}" controls></video>
            <div class="controls">
              <button onclick="player.play()">‚ñ∂Ô∏è Play</button>
              <button onclick="player.pause()">‚è∏Ô∏è Pause</button>
              <button onclick="player.currentTime -= 10">‚è™ Rewind 10s</button>
            </div>
            <div class="duration" id="duration">‚è±Ô∏è Duration: loading...</div>
            <a href="${link}" download><button>üì• Download</button></a>
            <p><a href="./">‚¨ÖÔ∏è Back to list</a></p>
          `;

          const player = document.getElementById("player");
          player.addEventListener("loadedmetadata", () => {
            const dur = Math.floor(player.duration);
            const min = Math.floor(dur / 60);
            const sec = dur % 60;
            document.getElementById("duration").textContent =
              `‚è±Ô∏è Duration: ${min}m ${sec}s`;
          });
        }
      })
      .catch(err => {
        app.textContent = "‚ö†Ô∏è Failed to load manifest.";
        console.error(err);
      });
  </script>
</body>
</html>
